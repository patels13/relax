function Editor(options){options=options||{},options.element&&(this.element=options.element),options.toolbar=options.toolbar||Editor.toolbar,options.hasOwnProperty("status")||(options.status=["lines","words","cursor"]),this.options=options,this.element&&this.render()}var toolbar=[{name:"bold",action:toggleBold},{name:"italic",action:toggleItalic},"|",{name:"quote",action:toggleBlockquote},{name:"unordered-list",action:toggleUnOrderedList},{name:"ordered-list",action:toggleOrderedList},"|",{name:"link",action:drawLink},{name:"image",action:drawImage},"|",{name:"info",action:"http://lab.lepture.com/editor/markdown"},{name:"preview",action:togglePreview},{name:"fullscreen",action:toggleFullScreen}];Editor.toolbar=toolbar,Editor.markdown=function(text){return window.marked?marked(text):void 0},Editor.prototype.render=function(el){if(el||(el=this.element||document.getElementsByTagName("textarea")[0]),!this._rendered||this._rendered!==el){this.element=el;var options=this.options,self=this,keyMaps={};for(var key in shortcuts)!function(key){keyMaps[fixShortcut(key)]=function(cm){shortcuts[key](self)}}(key);keyMaps.Enter="newlineAndIndentContinueMarkdownList",this.codemirror=CodeMirror.fromTextArea(el,{mode:"markdown",theme:"paper",indentWithTabs:!0,lineNumbers:!1,extraKeys:keyMaps}),options.toolbar!==!1&&this.createToolbar(),options.status!==!1&&this.createStatusbar(),this._rendered=this.element}},Editor.prototype.createToolbar=function(items){if(items=items||this.options.toolbar,items&&0!==items.length){var bar=document.createElement("div");bar.className="editor-toolbar";var self=this;self.toolbar={};for(var i=0;i<items.length;i++)!function(item){var el;el=item.name?createIcon(item.name,item):"|"===item?createSep():createIcon(item),item.action&&("function"==typeof item.action?el.onclick=function(e){item.action(self)}:"string"==typeof item.action&&(el.href=item.action,el.target="_blank")),self.toolbar[item.name||item]=el,bar.appendChild(el)}(items[i]);var cm=this.codemirror;cm.on("cursorActivity",function(){var stat=getState(cm);for(var key in self.toolbar)!function(key){var el=self.toolbar[key];stat[key]?el.className+=" active":el.className=el.className.replace(/\s*active\s*/g,"")}(key)});var cmWrapper=cm.getWrapperElement();return cmWrapper.parentNode.insertBefore(bar,cmWrapper),bar}},Editor.prototype.createStatusbar=function(status){if(status=status||this.options.status,status&&0!==status.length){var bar=document.createElement("div");bar.className="editor-statusbar";for(var pos,cm=this.codemirror,i=0;i<status.length;i++)!function(name){var el=document.createElement("span");el.className=name,"words"===name?(el.innerHTML="0",cm.on("update",function(){el.innerHTML=wordCount(cm.getValue())})):"lines"===name?(el.innerHTML="0",cm.on("update",function(){el.innerHTML=cm.lineCount()})):"cursor"===name&&(el.innerHTML="0:0",cm.on("cursorActivity",function(){pos=cm.getCursor(),el.innerHTML=pos.line+":"+pos.ch})),bar.appendChild(el)}(status[i]);var cmWrapper=this.codemirror.getWrapperElement();return cmWrapper.parentNode.insertBefore(bar,cmWrapper.nextSibling),bar}},Editor.toggleBold=toggleBold,Editor.toggleItalic=toggleItalic,Editor.toggleBlockquote=toggleBlockquote,Editor.toggleUnOrderedList=toggleUnOrderedList,Editor.toggleOrderedList=toggleOrderedList,Editor.drawLink=drawLink,Editor.drawImage=drawImage,Editor.undo=undo,Editor.redo=redo,Editor.toggleFullScreen=toggleFullScreen,Editor.prototype.toggleBold=function(){toggleBold(this)},Editor.prototype.toggleItalic=function(){toggleItalic(this)},Editor.prototype.toggleBlockquote=function(){toggleBlockquote(this)},Editor.prototype.toggleUnOrderedList=function(){toggleUnOrderedList(this)},Editor.prototype.toggleOrderedList=function(){toggleOrderedList(this)},Editor.prototype.drawLink=function(){drawLink(this)},Editor.prototype.drawImage=function(){drawImage(this)},Editor.prototype.undo=function(){undo(this)},Editor.prototype.redo=function(){redo(this)},Editor.prototype.toggleFullScreen=function(){toggleFullScreen(this)};